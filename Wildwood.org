** Measurements

Starting at doorway between garage and hallway:

- Garage wall to living room opening:
- Garage wall to brick:
- Living room opening:
- Height of living room opening:   
- Garage wall to far family room wall:

** GUI

- Mostly text-based
- When you press a key it highlights the GUI part and names it
- Click on point and it highlights it and gives the reference name ready to be pasted
- Same with clicking on place where we want a point    

** Ideas

Orient up to 90Â°

wall height = 8'
6" walls

living = rectangle 38' x 14'6" with:
  opening on bottom wall 4' wide, 5'9" from left ("living-family")
  opening on right wall 6' wide, 4'6" from top
  window on top wall 5'11" wide, 5'3" from left, XX" from floor, XX" from ceiling
  6 windows on top wall XX' wide, 5'6" from right, XX" from floor, XX" from ceiling, XX" between windows

garage = rectangle 26' x 27'6" with:
  door on right wall 3' wide, 6" from bottom ("garage-family")
  door on bottom wall 3' wide, 2" from right
  window on top, XX" wide, XX" from left, XX" from floor, XX" from ceiling
  window on top, XX" wide, XX" from right, XX" from floor, XX" from ceiling
  garagedoor on left, XX" wide, XX" from bottom
  garagedoor on left, XX" wide, XX" from top

family = path heading right go 8'6", turn right, go 12', turn left, go 35',
              turn left, go 16', turn left, go 43'6", turn left, go 4'
  door on left, 3' wide, 6" from top ("garage-family")
  opening on top, 4' wide, 4' from left ("living-family")
  door on bottom, XX" wide, XX" from right, XX" from floor, XX" from ceiling
  opening on top, XX" wide, 6" from right
  patiodoor on bottom, XX" wide, 10'3" from right
  window on bottom, XX" wide, XX" from right, XX" from floor, XX" from ceiling
  window on bottom, XX" wide, XX" from right, XX" from floor, XX" from ceiling
  window on bottom, XX" wide, XX" from right, XX" from floor, XX" from ceiling

** Floor plan slices, extrude up until the slice is different

We will start with the floor pretending that the doors don't exist so
there will be openings there. Then we extrude up until we hit the
lowest window, then the slice changes and we extrude up again until
we get to a new slice, and on and on.

We should be able to use anything to generate the slices, not just
OpenSCAD.

#+name: compile
#+begin_src elisp
(org-babel-tangle)
(org-sbe run-metapost)
#+end_src

#+name: run-metapost
#+begin_src sh :results output
which mpost
cd output
pwd
#mpost --mem=metafun drawing.mp || cat drawing.log
#open -a Safari drawing.svg
context drawing.tex
#+end_src

#+begin_src metapost :tangle output/drawing.mp :noweb yes
outputtemplate := "%j.%o";
outputformat := "svg";
beginfig(0);
  <<wildwood>>
endfig;
end.
#+end_src


#+begin_src tex :tangle output/drawing.tex :noweb yes
        
\definefont[bahnlight][name:bahnschriftlight*default]
\definefont[dim][name:bahnschriftlight*default at 5pt]
\definefont[title][name:bahnschrift*default at 25pt]
                                            
\definepapersize [biggy] [width=530mm,height=230mm]
\setuppapersize[biggy]

\starttext
\setuppagenumbering[location=]
\title
405 N Wildwood Ln        
\bahnlight
\startMPcode{decimalfun}
  <<wildwood>>
\stopMPcode
\stoptext
#+end_src


We can draw a single point from a path like this:

  draw point 2 of garage withpen pencircle scaled 4bp;

#+name: wildwood
#+begin_src metapost
input TEX;
linecap := butt;
linejoin := mitered;

def drawwall (expr p, thickness) =
  pickup pencircle scaled (thickness*2);
  draw p withcolor .8 white;
  unfill p;
enddef;

def drawinterior (expr p) =
  pickup pencircle scaled 1bp;
  draw p;
enddef;

def doorup    (expr p, offset, length) = (p+(0,offset))--(p+(0,offset+length)); enddef;
def doordown  (expr p, offset, length) = (p-(0,offset))--(p-(0,offset+length)); enddef;
def doorright (expr p, offset, length) = (p+(offset,0))--(p+(offset+length,0)); enddef;
def doorleft  (expr p, offset, length) = (p-(offset,0))--(p-(offset+length,0)); enddef;

def drawwindowdown (expr p) =
  undraw p;
  draw p shifted (0,-3) withpen pencircle scaled .5bp;
  draw p shifted (0,-5.5) withpen pencircle scaled .5bp;
enddef;

def drawwindowup (expr p) =
  undraw p;
  draw p shifted (0,3) withpen pencircle scaled .5bp;
  draw p shifted (0,5.5) withpen pencircle scaled .5bp;
enddef;

def drawdimension(expr p, offset) =
  pickup pencircle scaled .7bp;
  drawdblarrow p shifted offset shortened 1.75bp;
  picture pic;
  l := arclength p;
  if (floor(l mod 12) = 0):
    pic := thelabel("\dim " & decimal(floor(l / 12)) & "' ", point 1/2 of p shifted offset);
  else:
    pic := thelabel("\dim " & decimal(floor(l / 12)) & "'" & decimal(floor(l mod 12)), point 1/2 of p shifted offset);
  fi
  unfill bbox pic;
  draw pic;
enddef;

primarydef pct along pat = % This was taken from from MetaFun's macros
  (arctime (pct * (arclength pat)) of pat) of pat
enddef;

ft = 12bp;
EstFt = 12bp; % Estimated feet, need to re-measure these dimensions

% L I V I N G  ---  K I T C H E N  ---   H A L L W A Y

A :=  4.090 ft;     AA := 23.070 ft;     BA :=  3.330 ft;    
B :=  8.095 ft;     AB :=  4.925 ft;     BB := 23.065 ft;
C := 18.530 ft;     AC := 10.580 ft;     BC := 19.190 ft;
D := 43.530 ft;     AD := 14.840 ft;     BD :=  2.410 ft;
E :=  8.550 ft;     AE :=  3.080 ft;     BE := 10.080 ft;
F :=  5.420 ft;     AF := 17.730 ft;     BF :=  2.415 ft;
G :=  3.015 ft;     AG := 12.52EstFt;    BG :=  3.115 ft;
H :=  1.910 ft;     AH := 14.890 ft;     BH :=  7.690 ft;
I :=  0.330 ft;     AI :=  5.690 ft;     BI := 15.470 ft;
J := 12.525 ft;     AJ :=  4.435 ft;     BJ :=  3.365 ft;
K := 15.975 ft;     AK :=  6.040 ft;     BK :=  3.985 ft;
L :=  2.155 ft;     AL :=  4.385 ft;     BL :=  6.900 ft;
M :=  7.950 ft;     AM :=  1.475 ft;     BM :=  1.220 ft;
N := 10.920 ft;     AN := 38.520 ft;     BN :=  4.900 ft;
O := 15.855 ft;                          BO :=  4.740 ft;
P := 17.110 ft;                          BP :=  6.400 ft;
Q := 22.905 ft;                          BQ :=  3.315 ft;
R := 24.460 ft;                          BR :=  2.400 ft;
S := 12.085 ft;                          
T :=  1.365 ft;                          
U :=  0.615 ft;                          
V :=  3.930 ft;
W :=  9.990 ft;
X := 15.975 ft;
Y :=  2.670 ft;

% L A U N D R Y
DA := 2.620 ft;
DB := 5.375 ft;
DC := 8.725 ft;
DD := 8.070 ft;
DE := 3.490 ft;
DF := 2.685 ft;
DG := 2.915 ft;
DH := 3.025 ft;
DI := 4.890 ft;
DJ := 3.025 ft;
DK := 2.840 ft;
DL := 2.250 ft;
DM := 2.615 ft;
DN := 3.060 ft;


path garage, livingroom, kitchen, blueroom, master, masterbath, hallbath, southbed, smallbed, laundry, laundrybath, entry;
garage := (0,0)--(312,0)--(312,330)--(0,330)--cycle;
livingroom := (0,0)--(AN,0)--(AN,AD)--(AN-AI,AD)..(AN-AI-AH/2,AD+AM)..(AN-AI-AH,AD)--(0,AD)--cycle;
kitchen := (0,0)--(E,0)--(E,-J)--(D,-J)--(D,K-J)--(0,K-J)--cycle;
blueroom := (0,0)--(132,0)--(132,192)--(0,192)--cycle;
master := (0,0)--(240,0)--(240,156)--(240-144,156)--(240-144,156+36)--(0,156+36)--cycle;
entry := (0,0)--(BB,0)--(BB,BI)--(BB-BJ,BI)--(BB-BJ,BK)--(BL,BK)--(BL,AD)--(0,AD)--cycle;
laundrybath := (0,0)--(DD,0)--(DD,DJ)--(DD-DH,DJ)--(DG,DI)--(0,DI)--cycle;
laundry := (0,0)--(DD,0)--(DD,J)--(0,J)--cycle;

livingroom  := livingroom shifted (lrcorner garage + (6,(K-J)+6));
kitchen     := kitchen shifted (lrcorner garage + (6,0));
blueroom    := blueroom shifted (lrcorner kitchen + (6,0));
master      := master shifted (lrcorner blueroom + (6,0));
entry       := entry shifted (lrcorner livingroom + (6,0));
laundry     := laundry shifted (lrcorner garage + (6,-J));
laundrybath := laundrybath shifted (lrcorner garage + (6,-J));

drawwall(garage , 6);
drawwall(livingroom, 6);
drawwall(kitchen, 6);
%drawwall(blueroom, 6);
%drawwall(master, 6);
drawwall(entry, 6);
drawwall(laundry, 6);
drawwall(laundrybath, 6);

% Kitchen floor
draw (point 2 of kitchen shifted (9.990ft,0))--(point 2 of kitchen shifted (9.990ft,K)) withpen pencircle scaled .1bp dashed evenly;

path chimney;
chimney := (0,0)--(D-W-C,0)--(D-W-C,Y)--(0,Y)--cycle;
chimney := chimney shifted (lrcorner garage + (6, 0)) shifted (C,K-J-Y);
fill chimney withpen pencircle scaled .7bp withcolor .7 white;
path hearth;
hearth := (0,0)--(AB,0)--(AB,2)--(0,2)--cycle;
hearth := hearth shifted (point 0 of livingroom) shifted (AA,0);
fill hearth withpen pencircle scaled .7bp withcolor .7 white;

%pickup pencircle scaled 1bp; draw chimney shifted (lrcorner garage + (6, 0));

path door[];
door[0]  := doorup    (point 1 of garage, 6, 36);       undraw door[0]; % Garage to family
door[1]  := doorup    (point 0 of garage, 5*12, 8*12);  undraw door[1]; % West garage door
door[2]  := doordown  (point 3 of garage, 2*12, 8*12);  undraw door[2]; % East garage door
door[3]  := doorup    (point 1 of livingroom, 49, 72);  undraw door[3]; % Living room to front entry
door[4]  := doorright (point 5 of kitchen,     A, B-A); undraw door[4]; % Living to garage entry
door[5]  := doorleft  (point 4 of kitchen,     U, V-U); undraw door[5]; % Family to front entry
door[6]  := doorright (point 0 of kitchen,     I, H-I); undraw door[6]; % Garage entry closet
door[7]  := doorright (point 0 of kitchen,     G, F-G); undraw door[7]; % Laundry room door
door[8]  := doorright (point 2 of kitchen,     P, Q-P); undraw door[8]; % Sliding door
door[9]  := doorleft  (point 1 of entry,      BH, BD); undraw door[9]; % Blue room door
door[10] := doorleft  (point 1 of entry,   BG-BF, BF); undraw door[10]; % Master room door
door[11] := doorright (point 5 of entry,      BQ, BR);  undraw door[11]; % Understairs closet door
door[12] := doorup    (point 5 of entry,      BM, BN);  undraw door[12]; % Entry closet door
door[13] := doorleft  (point 6 of entry, 0.7EstFt, 5.5EstFt); undraw door[13]; % Front entry door

path window[];

window[0] := doorright (point 2 of kitchen,    L, M-L); % Window over sink
window[1] := doorright (point 2 of kitchen,    N, O-N); % Family room picture window
window[2] := doorright (point 2 of kitchen,    R, S-T); % Family room big window
drawwindowdown(window[0]);
drawwindowdown(window[1]);
drawwindowdown(window[2]);

% Big rounded window
window[3] := (point 3 of livingroom)..(point 4 of livingroom)..(point 5 of livingroom);
undraw window[3] shortened 3bp;
draw window[3] shortened 1bp shifted (0,3) withpen pencircle scaled .5bp;
draw window[3] shortened 1bp shifted (0,5.5) withpen pencircle scaled .5bp;

window[4] := doorright (point 6 of livingroom, AE, AF-AG);
drawwindowup(window[4]);

drawinterior(garage);
drawinterior(livingroom);
drawinterior(kitchen);
drawinterior(entry);
%drawinterior(blueroom);
%drawinterior(master);

drawdimension((point 0 of door[1])--(point 0 of garage), (5,0));
drawdimension((point 0 of door[2])--(point 3 of garage), (10,0));
drawdimension((point 1 of door[1])--(point 1 of door[2]), (5,0));
drawdimension((point 0 of garage)--(point 3 of garage), (20,0));
drawdimension((point 2 of garage)--(point 3 of garage), (0,-20));
drawdimension((point 5 of kitchen)--(point 4 of kitchen), (0,-15));
drawdimension((point 5 of kitchen)--(point 0 of door[4]), (0,-5));
drawdimension((point 1 of kitchen)--(point 2 of kitchen), (7,0));
drawdimension((point 3 of kitchen)--(point 4 of kitchen), (-9,0));
drawdimension((point 3 of kitchen)--(point 4 of kitchen), (-9,0));
drawdimension((point 0 of livingroom)--(point 6 of livingroom), (10,0));
drawdimension((point 6 of livingroom)--(point 2 of livingroom), (0,-15));
drawdimension((point 0 of entry)--(point 1 of entry), (0,25));

%path outline; outline = (0,-50)--(100,-50)--(100,50)--(0,50)--cycle;
%clip currentpicture to outline; draw outline;

%path p;
%p := (point 2 of garage)..(point 3 of garage);
%drawdblarrow p withcolor blue;

#+end_src


#+begin_src elisp
(fset 'org-babel-copy-current-src
   (kmacro-lambda-form [?\C-r ?# ?+ ?b ?e ?g ?i ?n ?_ ?s ?r ?c ?\C-a down ?\C-  ?\C-s ?# ?+ ?e ?n ?d ?_ ?s ?r ?c ?\C-a ?\M-w] 0 "%d"))
(global-set-key (kbd "<f5>") 'org-babel-copy-current-src)
#+end_src


*** Try out templating to Metapost directly from Python

#+begin_src python :results output
def draw(*args):
    path = '--'.join([f'({x}ft,{y}ft)' for x, y in args])
    print(f'draw {path}--cycle;')

print('ft = 1cm; pickup pensquare scaled 1bp;')
draw((0,0), (26,0), (26,27.5), (0,27.5))
print('pickup pensquare scaled 0.5ft;')

#+end_src

#+RESULTS:
: ft = 1cm; pickup pensquare scaled 1bp;
: draw (0ft,0ft)--(26ft,0ft)--(26ft,27.5ft)--(0ft,27.5ft)--cycle;
: pickup pensquare scaled 0.5ft;

*** Try out templating to Metapost using Jinja templates
  
  


** Build a wall at a time

#+begin_src scad
include <BOSL/constants.scad>
use <BOSL/transforms.scad>

// Living east wall
difference() {
  cube([38, 0.5, 8]);
  right(5) cube([4, 0.5, 7]);
}

// Living north wall
cube([14.5])
#+end_src

