
* Tables
** Measurements

This is where we put all of the raw measurements. I like to draw a
room on paper and label all of the possible dimensions. Then I fill
in those labels on another paper with the labels listed out.

In this example I am using feet with decimal fractions. I find this a
lot easier to deal with than feet, inches, and 16ths of an inch. It's
clear that I have too many significant digits but I like to just
record exactly what the laser measuring tool tells me and know that
small inaccuracies will average out in the end.

Also note that the measurements labeled with "℮" are estimates. This
is where I screwed something up during the measurement or I couldn't
get my tool into a small place.

Note that you can also define measurements in terms of other
measurements either in this same room or other. See Hallbath
below as an example. These equations follow the same rules
layed on in Metapost.

#+name: Measurements
|   | kitchen | livingroom |  entry | laundry | smallbed | southbed | master | masterbath | hallbath | blueroom | southhall | garage | recroom | trollroom | chimneyroom | garageattic |
|   |         |          A |      B |       D |        E |        F |      J |          G |        H |        I |         K |      L | M       | P         | N           | O           |
| A |   4.090 |     23.070 |  3.330 |   2.620 |   12.000 |   12.295 | 12.435 |      3.095 |   12.290 |   15.985 |     4.955 | 27.415 |         |           |             |             |
| B |   8.095 |      4.925 | 23.065 |   5.375 |    7.370 |   15.170 |  4.315 |     ℮ 4/12 |    7.110 |   10.990 |     1.030 | 26.160 |         |           |             |             |
| C |  18.530 |     10.580 | 19.190 |   8.725 |    3.550 |    5.395 |  4.960 |      2.415 |    9.325 |    1.535 |     2.415 |  4.040 |         |           |             |             |
| D |  43.530 |     14.840 |  2.410 |   8.070 |   14.900 |    3.600 | 16.500 |     ℮ 4/12 |    4.815 |    1.520 |     1.215 |  1.305 |         |           |             |             |
| E |   8.550 |      3.080 | 10.080 |   3.490 |    1.135 |    3.835 | 19.405 |      6.920 |    3.170 |    2.950 |     1.915 |  3.955 |         |           |             |             |
| F |   5.420 |     17.730 |  2.415 |   2.685 |    4.630 |    7.375 |  1.490 |      2.420 |    3.095 |    0.990 |     2.495 | 13.115 |         |           |             |             |
| G |   3.015 |   ℮ 12.520 |  3.115 |   2.915 |    2.420 |   11.445 |  4.805 |      2.075 |    1.270 |    0.565 |     1.595 | 13.085 |         |           |             |             |
| H |   1.910 |     14.890 |  7.690 |   3.025 |    3.655 |    2.415 |  2.450 |      9.005 |    2.925 |    7.455 |           |        |         |           |             |             |
| I |   0.330 |      5.690 | 15.470 |   4.890 |   11.955 |    4.370 |  1.040 |      4.465 |    2.260 |    5.895 |           |  3.380 |         |           |             |             |
| J |  12.525 |      4.435 |  3.365 |   3.025 |    3.740 |    4.115 |  2.340 |      0.790 |    2.010 |    7.025 |     0.555 |  3.380 |         |           |             |             |
| K |  15.975 |      6.040 |  3.985 |   2.840 |    1.800 |    3.405 |  0.825 |      1.245 |    2.530 |    0.560 |           |  3.640 |         |           |             |             |
| L |   2.155 |      4.385 |  6.900 |   2.250 |    6.655 |    2.450 | 15.975 |      5.440 |          |    0.565 |     0.590 |  3.780 |         |           |             |             |
| M |   7.950 |      1.475 |  1.220 |   2.615 |    2.315 |    0.610 | 12.690 |      2.000 |          |    2.485 |     9.420 | 12.180 |         |           |             |             |
| N |  10.920 |     38.520 |  4.900 |   3.060 |    2.450 |          |  6.715 |     12.235 |    0.745 |   13.260 |           |  0.570 |         |           |             |             |
| O |  15.855 |            |  4.740 |         |    0.910 |          |  0.785 |      3.020 |    1.915 |          |           |  2.670 |         |           |             |             |
| P |  17.110 |            |  6.400 |         |   10.590 |          | ℮ 4/12 |      4.880 |          |          |           |  5.395 |         |           |             |             |
| Q |  22.905 |            |  3.315 |         |    3.905 |          | ℮ 8/12 |      6.830 |    2.425 |          |           | 15.485 |         |           |             |             |
| R |  24.460 |            |  2.400 |         |    3.365 |          |  3.785 |      0.825 |    6.240 |          |           |  2.850 |         |           |             |             |
| S |   1.355 |            |        |         |    4.885 |          |  7.560 |      3.700 | HT-HE-HI |          |           |  2.600 |         |           |             |             |
| T |  10.500 |            |        |         |    7.510 |          |  8.005 |     ℮ 4/12 | HF+HH+HG |          |           |        |         |           |             |             |
| U |   0.615 |            |        |         |    1.330 |          |        |      5.010 |          |          |           |        |         |           |             |             |
| V |   3.930 |            |        |         |    1.335 |          |        |            |          |          |           |        |         |           |             |             |
| W |   9.990 |            |        |         |          |          |        |            |          |          |           |        |         |           |             |             |
| X |  15.975 |            |        |         |          |          |        |            |          |          |           |        |         |           |             |             |
| Y |   2.670 |            |        |         |          |          |        |            |          |          |           |        |         |           |             |             |
| Z |         |            |        |         |          |          |        |            |          |          |           |        |         |           |             |             |

** Paths

This is where we define the paths that each of the rooms' walls make.
This is a huge departure from normal floorplan applications. We are
going to define each room seperately starting at the origin and moving
around counter-clockwise until we form a cycle. We ignore all windows,
doors, and shared walls at this point. This is just defining the
interior perception of a room.

These are cartesian coordinates. Note that it doesn't matter that you
go into the negative, but I like to keep all of my origins at the
perceptual lower-left of the room.

I may change this to optionally allow turtle-style paths since they
are more natural to define.

#+name: Paths
| Room              | Path                                                                                    |
| garage            | (0,0)--(LB,0)--(LB,LA)--(0,LA)--cycle                                                   |
| livingroom        | (0,0)--(AN,0)--(AN,AD)--(AN-AI,AD)..(AN-AI-AH/2,AD+AM)..(AN-AI-AH,AD)--(0,AD)--cycle    |
| kitchen           | (0,0)--(E,0)--(E,-J)--(D,-J)--(D,K-J)--(0,K-J)--cycle                                   |
| blueroom          | (0,0)--(IB,0)--(IB,IA)--(IH,IA)--(IH,IN)--(0,IN)--cycle                                 |
| master            | (0,0)--(JD,0)--(JD,JA)--(JD-JM,JA)--(JD-JM,JL)--(0,JL)--cycle                           |
| masterclosetwest  | (0,0)--(JH,0)--(JH,JT)--(0,JT)--cycle                                                   |
| mastercloseteast  | (0,0)--(JH,0)--(JH,JS)--(0,JS)--cycle                                                   |
| entry             | (0,0)--(BB,0)--(BB,BI)--(BB-BJ,BI)--(BB-BJ,BK)--(BL,BK)--(BL,AD)--(0,AD)--cycle         |
| laundrybath       | (0,0)--(DD,0)--(DD,DJ)--(DD-DH,DJ)--(DG,DI)--(0,DI)--cycle                              |
| laundry           | (0,0)--(DD,0)--(DD,J-th)--(0,J-th)--cycle                                               |
| kitchenhallcloset | (0,0)--(DL,0)--(DL,DM)--(0,DM)--cycle                                                   |
| smallbed          | (0,0)--(EI,0)--(EI,EF)--(EI+EO,EF)--(EI+EO,EA)--(EM,EA)--(EM,EC)--(0,EC)--cycle         |
| smallbedcloset    | (0,0)--(ET,0)--(ET,EN)--(0,EN)--cycle                                                   |
| southbed          | (0,0)--(FA,0)--(FA,FG)--(0,FG)--cycle                                                   |
| southbedcloset    | (0,0)--(FL,0)--(FL,FF)--(0,FF)--cycle                                                   |
| entrycloset       | (0,0)--(1.8est,0)--(1.8est,6.400ft)--(0,6.4000ft)--cycle                            |
| southhallcloset   | (0,0)--(KG,0)--(KG,KF)--(0,KF)--cycle                                                   |
| masterbathsink    | (0,0)--(GE,0)--(GE,GH)--(GF,GH)--(GF,GA)--(0,GA)--cycle                                 |
| masterbathcloset  | (0,0)--(GM,0)--(GM,GL)--(0,GL)--cycle                                                   |
| masterbathtoilet  | (0,0)--(GP,0)--(GP,GQ)--(0,GQ)--cycle                                                   |
| hallbath          | (0,0)--(GE+th,0)--(GE+th,-2.1est)--(FA,-2.1est)--(FA,5.5est)--(0,5.5est)--cycle |
| hallbathcloset    | (0,0)--(HK,0)--(HK,HJ)--(0,HJ)--cycle                                                   |

** Relative Positions

This is where we define the relative positions of the rooms. For
example room 1's upper right corner might be the same as Room 2's
lower left corner.

#+name: Positions
| livingroom        | lrcorner garage + (th,(K-J)+th)                                       |
| kitchen           | lrcorner garage + (th,0)                                              |
| entry             | lrcorner livingroom + (th,0)                                          |
| laundry           | lrcorner garage + (th,-J)                                             |
| laundrybath       | lrcorner garage + (th,-J)                                             |
| kitchenhallcloset | lrcorner garage + (th,-DM-th)                                         |
| smallbed          | point 6 of entry + (th,-EC)                                           |
| smallbedcloset    | point 1 of smallbed + (-ER-ES-EV,-EN-th)                              |
| southbed          | point 2 of entry + (th,-FH-FM-th-1)                                   |
| southbedcloset    | point 3 of smallbed + (th,0)                                          |
| entrycloset       | point 5 of entry + (th,th)                                            |
| blueroom          | lrcorner kitchen + (th,0)                                             |
| master            | point 1 of entry + (-JR,-X-th)                                        |
| masterclosetwest  | point 0 of master + (-JH-th,0)                                        |
| mastercloseteast  | point 0 of master + (-JH-th,JT+th)                                    |
| southhallcloset   | point 4 of entry + (-KG-th,KB+KC+KJ+th)                               |
| masterbathsink    | point 3 of master + (th,th)                                           |
| masterbathcloset  | point 3 of master + (th,GA+th+th)                                     |
| masterbathtoilet  | point 3 of master + (th+GE+th,th)                                     |
| hallbath          | point 3 of masterbathcloset + (0,th)                                  |
| hallbathcloset    | point 5 of hallbath + (0,-HJ)                                         |

** Doors

#+name: Doors
| id | name                         | door dir | out dir | starting point              | offset   | width        |
|  0 | "Garage to family"           | up       | right   | point 1 of garage           | LN       | LO           |
|  1 | "West garage door"           | up       | left    | point 0 of garage           | LL       | LF-LL        |
|  2 | "East garage door"           | down     | left    | point 3 of garage           | LE       | LG-LE        |
|  3 | "Living room to front entry" | up       | right   | point 1 of livingroom       | 49       | 72           |
|  4 | "Living to garage entry"     | right    | up      | point 5 of kitchen          | A        | B-A          |
|  5 | "Family to front entry"      | left     | up      | point 4 of kitchen          | U        | V-U          |
|  6 | "Garage entry closet"        | right    | down    | point 0 of kitchen          | I        | H-I          |
|  7 | "Laundry room door"          | right    | down    | point 0 of kitchen          | G        | F-G          |
|  8 | "Sliding door"               | right    | down    | point 2 of kitchen          | P        | Q-P          |
|  9 | "Blue room door"             | left     | down    | point 1 of entry            | BH       | BD           |
| 10 | "Master room door"           | left     | down    | point 1 of entry            | BG-BF    | BF           |
| 11 | "Understairs closet door"    | right    | up      | point 5 of entry            | BQ       | BR           |
| 12 | "Entry closet door"          | up       | right   | point 5 of entry            | BM       | BN           |
| 13 | "Front entry door"           | left     | up      | point 6 of entry            | 0.7 est  | 5.5 est      |
| 14 | "Door to south bedroom"      | up       | left    | point 0 of southbed         | FM       | FH           |
| 15 | "Door to small bedroom"      | up       | right   | point 1 of smallbed         | EE       | EG           |
| 16 | "Small room closet"          | left     | down    | point 1 of smallbed         | ER       | ES           |
| 17 | "Master bath door"           | up       | right   | point 3 of master           | JO       | JL-JA-JO-JP  |
| 18 | "Master closet door 1"       | up       | left    | point 0 of master           | JI       | JT-JI-(JJ/2) |
| 19 | "Master closet door 2"       | down     | left    | point 5 of master           | JK       | JS-JK-(JJ/2) |
| 20 | "Blue room closet door"      | right    | up      | point 5 of blueroom         | IG       | II           |
| 21 | "South hall closet door"     | up       | left    | point 4 of entry            | KB+KC+KD | KE           |
| 22 | "Attic door"                 | up       | left    | point 4 of entry            | KB       | KC           |
| 23 | "Master bath door to toilet" | up       | right   | point 1 of masterbathsink   | GG       | GQ-GO-GG     |
| 24 | "Master bath closet door"    | up       | right   | point 1 of masterbathcloset | GK       | GL-GJ-GK     |
| 25 | "Hall bath closet door"      | left     | up      | point 1 of hallbathcloset   | HN-th    | HO           |
| 26 | "South bed closet door"      | up       | right   | point 1 of southbedcloset   | 1 est    | 5 est        |

** Windows

#+name: Windows


* Python
** Define the rooms as Metapost paths

#+name: definerooms
#+begin_src python :var measurements=Measurements :var paths=Paths :var positions=Positions :results output
names = measurements[0][1:]
prefix = dict(zip(names, measurements[1][1:]))
prefix.setdefault('')
data = list(zip(*measurements[2:])) # transpose
suffix, data = data[0], data[1:]
err = lambda e: e.strip('℮') + ' est' if isinstance(e, str) and '℮' in e else f'{e} ft'

for i, d in enumerate(data):
    n = names[i]
    s = suffix[i]
    p = prefix[n]
    defs = [f'{p}{k} := {err(v)};' for k, v in zip(suffix, d) if f'{p}{k}' != 'MP']
    print(f'% {n} ({p})')
    print('\n'.join(defs))

paths = paths[1:]

print()
print('path', ', '.join(list(zip(*paths))[0]), ';')
print()
print('\n'.join(f'{k} := {v};' for k, v in paths))
print()
print('\n'.join(f'{k} := {k} shifted ({v});' for k, v in positions))
#+end_src

** Draw the walls, doors, and windows

#+name: drawwalls
#+begin_src python :var paths=Paths :results output
paths = paths[1:]
paths = list(zip(*paths))[0]
print("""
def drawwall (expr p, thickness) =
  pickup pencircle scaled (thickness*2);
  draw p withcolor .8 white;
  fill p withcolor background withtransparency ("normal", 1);
enddef;
""")
print('\n'.join((f'drawwall({s}, th);' for s in paths)))
print()
print('pickup pencircle scaled 1bp;')
print('\n'.join((f'draw {s};' for s in paths)))
#+end_src


#+name: drawdoors
#+begin_src python :var doors=Doors :results output
print("""
path door[];
def drawdoor (expr direction, outdirection, start, offset, width, i) =
  pickup pencircle scaled (th+2bp); % 2bp for the width of the interior lines on either side
  door[i] = (direction*offset + start)..(direction*offset+direction*width + start);
  undraw door[i] shifted (outdirection * th/2);
  % Uncomment to show doors
  %draw door[i] shifted (outdirection * th/2) withcolor blue withtransparency ("normal", .5);
enddef;
""")
doors = doors[1:]
for i, name, direction, outdir, start, offset, width in doors:
    print(f'drawdoor({direction}, {outdir}, {start}, {offset}, {width}, {i});');
#+end_src

** Main Metapost picture

#+begin_src tex :tangle house.tex :noweb yes
        
\definefont[bahnlight][name:bahnschriftlight*default]
\definefont[small][name:bahnschriftlight*default at 8pt]
\definefont[roomname][name:bahnschriftlight*default at 15pt]
\definefont[dim][name:bahnschriftlight*default at 5pt]
\definefont[title][name:bahnschrift*default at 25pt]
                                            
\definepapersize [biggy] [width=550mm,height=230mm]
\setuppapersize[biggy]

\starttext
\setuppagenumbering[location=]
\bahnlight
\startMPcode{decimalfun}
  input TEX;
  linecap := butt;
  linejoin := mitered;
  ft = 12bp;  % Let's make a big point (bp) equal to one inch in the plans
  est = 12bp; % Estimated feet are the same, but we mark them so we know they may not be perfect
  th := 0.445est; % Interior wall thickness 
  <<definerooms()>>
  <<drawwalls()>>
  <<drawdoors()>>
\stopMPcode
\stoptext
#+end_src
